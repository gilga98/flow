<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>SproutList</title>
    <meta name="description" content="A mindful daily timetable app to help you grow.">
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/svg+xml" href="logo-square.svg">
    <link rel="apple-touch-icon" href="logo-square.svg">
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        darkMode: 'class',
        theme: {
          extend: {
            colors: {
              border: "hsl(var(--border))",
              input: "hsl(var(--input))",
              ring: "hsl(var(--ring))",
              background: "hsl(var(--background))",
              foreground: "hsl(var(--foreground))",
              primary: {
                DEFAULT: "hsl(var(--primary))",
                foreground: "hsl(var(--primary-foreground))",
              },
              secondary: {
                DEFAULT: "hsl(var(--secondary))",
                foreground: "hsl(var(--secondary-foreground))",
              },
              destructive: {
                DEFAULT: "hsl(var(--destructive))",
                foreground: "hsl(var(--destructive-foreground))",
              },
              muted: {
                DEFAULT: "hsl(var(--muted))",
                foreground: "hsl(var(--muted-foreground))",
              },
              accent: {
                DEFAULT: "hsl(var(--accent))",
                foreground: "hsl(var(--accent-foreground))",
              },
              popover: {
                DEFAULT: "hsl(var(--popover))",
                foreground: "hsl(var(--popover-foreground))",
              },
              card: {
                DEFAULT: "hsl(var(--card))",
                foreground: "hsl(var(--card-foreground))",
              },
            },
            borderRadius: {
              lg: "var(--radius)",
              md: "calc(var(--radius) - 2px)",
              sm: "calc(var(--radius) - 4px)",
            },
          },
        },
      }
    </script>
    
    <link rel="stylesheet" href="style.css">
    
    <!-- Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <meta name="theme-color" content="#ffffff" media="(prefers-color-scheme: light)">
    <meta name="theme-color" content="#09090b" media="(prefers-color-scheme: dark)">
</head>
<body class="antialiased font-sans transition-colors duration-300">
    <div id="toast-container"></div>
    <div id="app" class="min-h-[100dvh] bg-background text-foreground flex flex-col">
        <!-- Header -->
        <header class="sticky top-0 z-50 w-full border-b bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60">
            <div class="container flex h-14 max-w-screen-2xl items-center justify-between px-4 mx-auto">
                <div class="flex items-center gap-2 font-bold text-xl tracking-tight">
                    <img src="logo-horizontal.svg" alt="SproutList" class="h-8 w-auto">
                </div>
                <div class="flex items-center gap-3">
                    <div id="reward-container" class="flex flex-col items-end gap-1 cursor-pointer hover:opacity-80 transition-opacity" onclick="openRewardsProfile()">
                        <div class="flex items-center gap-2">
                             <div id="level-badge" class="px-2 py-0.5 bg-primary/10 border border-primary/20 text-[10px] font-bold text-primary rounded-full uppercase tracking-tighter shadow-sm flex items-center gap-1">
                                <span id="level-icon-wrapper"><i data-lucide="sprout" class="h-3 w-3"></i></span>
                                Lvl <span id="level-value">1</span>
                            </div>
                            <div id="points-display" class="relative flex items-center gap-1.5 px-3 py-1 bg-secondary rounded-full border border-border shadow-sm transition-all duration-300 overflow-hidden">
                                <i id="points-icon" data-lucide="seed" class="h-3.5 w-3.5 text-primary fill-primary/20"></i>
                                <span id="points-value" class="text-sm font-semibold tabular-nums">0</span>
                            </div>
                        </div>
                        <div class="w-24 h-1.5 bg-secondary rounded-full overflow-hidden border border-border/50">
                            <div id="level-progress" class="h-full bg-primary transition-all duration-500 ease-out" style="width: 0%"></div>
                        </div>
                    </div>
                    <button id="theme-toggle" class="h-9 w-9 inline-flex items-center justify-center rounded-md border border-input bg-background text-sm font-medium ring-offset-background transition-colors hover:bg-accent hover:text-accent-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50">
                        <i data-lucide="sun" class="h-5 w-5 rotate-0 scale-100 transition-all dark:-rotate-90 dark:scale-0"></i>
                        <i data-lucide="moon" class="absolute h-5 w-5 rotate-90 scale-0 transition-all dark:rotate-0 dark:scale-100"></i>
                        <span class="sr-only">Toggle theme</span>
                    </button>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="flex-1 container px-4 py-8 max-w-lg mx-auto w-full pb-32">
            
            <!-- Greeting & Weather -->
            <section id="greeting-section" class="mb-8 animate-in fade-in slide-in-from-top-4 duration-700">
                <div class="flex items-center justify-between">
                    <div>
                        <h1 id="greeting-text" class="text-3xl sm:text-4xl font-black tracking-tight text-foreground">Good Morning</h1>
                        <p id="full-date-display" class="text-muted-foreground font-medium mt-1">Downloading...</p>
                    </div>
                    <div id="weather-widget" class="hidden flex-col items-end text-right bg-card/50 backdrop-blur-sm p-3 rounded-2xl border border-border/50 shadow-sm">
                         <div class="flex items-center gap-2">
                            <i id="weather-icon" data-lucide="sun" class="h-6 w-6 text-orange-500 fill-orange-500/20"></i>
                            <span id="weather-temp" class="text-2xl font-black tracking-tight">--Â°</span>
                        </div>
                        <span id="weather-desc" class="text-xs text-muted-foreground font-bold uppercase tracking-wider">Loading...</span>
                    </div>
                </div>
            </section>

            <!-- Dashboard / Hero -->
            <section id="dashboard" class="mb-10 group">
                <div class="rounded-xl border bg-card text-card-foreground shadow-sm transition-all duration-300 hover:shadow-md">
                    <div class="p-6 flex flex-col space-y-2">
                        <div class="flex items-center justify-between">
                            <h3 class="text-[10px] font-bold tracking-widest text-muted-foreground uppercase opacity-70">Current Session</h3>
                            <div class="h-2 w-2 rounded-full bg-primary animate-pulse"></div>
                        </div>
                        <div id="current-task-display" class="text-3xl font-extrabold tracking-tight pt-1">
                            Relaxing
                        </div>
                        <div class="flex items-center gap-2 text-sm text-muted-foreground font-medium">
                            <i data-lucide="clock" class="h-3.5 w-3.5"></i>
                            <span id="current-task-time">Now</span>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Tabs -->
            <!-- Tabs -->
            <div class="mb-6">
                <div class="flex w-full items-center p-1 bg-muted rounded-lg border border-border/50 overflow-x-auto no-scrollbar">
                    <button data-tab="timeline" class="tab-btn active min-w-fit flex-1 inline-flex items-center justify-center whitespace-nowrap rounded-md px-3 py-1.5 text-sm font-medium transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50">
                        <i data-lucide="list-todo" class="h-4 w-4 mr-2"></i>Timeline
                    </button>
                    <button data-tab="notes" class="tab-btn min-w-fit flex-1 inline-flex items-center justify-center whitespace-nowrap rounded-md px-3 py-1.5 text-sm font-medium transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50">
                        <i data-lucide="brain" class="h-4 w-4 mr-2"></i>Notes
                    </button>
                    <button data-tab="utilities" class="tab-btn min-w-fit flex-1 inline-flex items-center justify-center whitespace-nowrap rounded-md px-3 py-1.5 text-sm font-medium transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50">
                        <i data-lucide="zap" class="h-4 w-4 mr-2"></i>Utilities
                    </button>
                    <button data-tab="settings" class="tab-btn min-w-fit flex-1 inline-flex items-center justify-center whitespace-nowrap rounded-md px-3 py-1.5 text-sm font-medium transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50">
                        <i data-lucide="settings-2" class="h-4 w-4 mr-2"></i>Settings
                    </button>
                </div>
            </div>

            <!-- Timeline View -->
            <section id="view-timeline" class="tab-content block space-y-6">
                <div class="flex justify-between items-end mb-6">
                    <div>
                        <h2 class="text-2xl font-bold tracking-tight">Timeline</h2>
                        <p class="text-xs text-muted-foreground font-medium" id="selected-date-display">Today</p>
                    </div>
                    <div class="flex items-center gap-2">
                        <button id="select-mode-btn" class="inline-flex items-center justify-center rounded-lg text-sm font-medium border border-input bg-background h-10 px-4 py-2 hover:bg-accent transition-colors">
                            Select
                        </button>
                        <button id="add-task-btn" class="inline-flex items-center justify-center rounded-lg text-sm font-medium ring-offset-background transition-all hover:scale-[1.02] active:scale-[0.98] bg-primary text-primary-foreground h-10 px-4 py-2 hover:bg-primary/90 shadow-sm shadow-primary/20">
                            <i data-lucide="plus" class="h-4 w-4 mr-2"></i> Add Task
                        </button>
                    </div>
                </div>

                <!-- Weekly Scroller -->
                <div id="weekly-scroller" class="flex gap-3 overflow-x-auto pb-4 -mx-4 px-4 no-scrollbar">
                    <!-- Days injected here -->
                </div>
                
                <div id="timeline-list" class="space-y-4 relative pl-2">
                    <!-- Tasks injected here -->
                </div>
                
                <div id="empty-state" class="hidden flex flex-col items-center justify-center py-20 text-center animate-in fade-in zoom-in duration-500">
                    <div class="h-20 w-20 flex items-center justify-center mb-4 opacity-50 grayscale">
                        <img src="logo-square.svg" alt="No tasks" class="h-16 w-16">
                    </div>
                    <h3 class="font-semibold text-lg">No tasks scheduled</h3>
                    <p class="text-sm text-muted-foreground max-w-[200px] mt-1">Add your daily rituals and tasks to start flowing.</p>
                </div>
            </section>

            <!-- Notes View -->
            <section id="view-notes" class="tab-content hidden space-y-6">
                 <div class="flex justify-between items-center mb-2">
                    <h2 class="text-2xl font-bold tracking-tight">Brain Dump</h2>
                    <button id="add-note-btn" class="inline-flex items-center justify-center rounded-lg text-sm font-medium ring-offset-background transition-all hover:scale-[1.02] active:scale-[0.98] bg-secondary text-secondary-foreground h-10 px-4 py-2 hover:bg-secondary/80 border border-border">
                        <i data-lucide="sticky-note" class="h-4 w-4 mr-2"></i> New Note
                    </button>
                </div>
                <div id="notes-list" class="grid grid-cols-1 gap-4">
                    <!-- Notes injected here -->
                </div>

                <div id="notes-empty-state" class="hidden flex flex-col items-center justify-center py-20 text-center animate-in fade-in zoom-in duration-500">
                    <div class="h-20 w-20 flex items-center justify-center mb-4 transition-transform hover:scale-110 duration-300 opacity-50 grayscale">
                        <img src="logo-square.svg" alt="No notes" class="h-16 w-16">
                    </div>
                    <h3 class="font-bold text-lg tracking-tight">Your brain, offloaded</h3>
                    <p class="text-sm text-muted-foreground max-w-[240px] mt-2 leading-relaxed">Capture fleeting thoughts, ideas, or to-dos. Let Flow remember for you.</p>
                </div>
            </section>

            <!-- Utilities View -->
            <section id="view-utilities" class="tab-content hidden space-y-6">
                <!-- Header & Toggle -->
                <div class="flex items-center justify-between gap-2 overflow-hidden">
                    <h2 class="text-2xl font-bold tracking-tight shrink-0">Utilities</h2>
                    <div class="bg-muted p-1 rounded-lg flex items-center overflow-x-auto no-scrollbar shrink">
                        <button id="util-tab-focus" class="px-3 py-1 rounded-md text-xs font-bold shadow-sm bg-background text-foreground transition-all whitespace-nowrap">Focus</button>
                        <button id="util-tab-breath" class="px-3 py-1 rounded-md text-xs font-bold text-muted-foreground transition-all hover:text-foreground whitespace-nowrap">Breath</button>
                        <button id="util-tab-water" class="px-3 py-1 rounded-md text-xs font-bold text-muted-foreground transition-all hover:text-foreground whitespace-nowrap">Hydrate</button>
                    </div>
                </div>

                <!-- Focus Timer -->
                <div id="util-focus" class="flex flex-col items-center space-y-8 animate-in fade-in slide-in-from-bottom-4">
                    <div class="text-center space-y-1">
                        <h3 id="timer-task-label" class="text-lg font-medium text-muted-foreground px-4 truncate max-w-xs">Ready to Focus?</h3>
                        <div id="timer-display" class="text-7xl font-black font-mono tracking-tighter tabular-nums variant-numeric-slash-zero">25:00</div>
                    </div>
                    
                    <div class="relative h-64 w-64 flex items-center justify-center">
                        <!-- Background Ring -->
                        <div class="absolute inset-0 rounded-full border-[6px] border-muted"></div>
                         <!-- Progress Ring -->
                        <svg class="absolute inset-0 -rotate-90 transform h-64 w-64" viewBox="0 0 100 100">
                            <!-- 2*pi*r where r=46 is approx 289 -->
                            <circle cx="50" cy="50" r="46" fill="transparent" stroke="currentColor" stroke-width="6" stroke-linecap="round" class="text-primary transition-all duration-1000 ease-linear" stroke-dasharray="289" stroke-dashoffset="0" id="timer-ring"></circle>
                        </svg>
                        
                        <button id="timer-toggle-btn" class="h-24 w-24 rounded-full bg-primary text-primary-foreground flex items-center justify-center shadow-xl hover:scale-105 active:scale-95 transition-all z-10">
                            <i data-lucide="play" class="h-10 w-10 fill-current pl-1"></i>
                        </button>
                    </div>

                    <div class="flex items-center gap-4">
                        <button id="timer-reset-btn" class="h-12 w-12 rounded-full border border-input flex items-center justify-center hover:bg-accent hover:text-accent-foreground transition-all" title="Reset">
                            <i data-lucide="rotate-ccw" class="h-5 w-5"></i>
                        </button>
                         <button id="timer-finish-btn" class="h-12 w-12 rounded-full border border-input flex items-center justify-center hover:bg-accent hover:text-accent-foreground transition-all opacity-50 pointer-events-none" title="Finish Early">
                            <i data-lucide="check" class="h-5 w-5"></i>
                        </button>
                    </div>

                    <!-- Presets -->
                    <div class="grid grid-cols-3 gap-2 w-full max-w-xs">
                        <button class="timer-preset py-2 px-3 rounded-lg border border-border bg-card hover:border-primary/50 text-xs font-semibold transition-all data-[active=true]:bg-primary data-[active=true]:text-primary-foreground" data-time="25">Focus</button>
                        <button class="timer-preset py-2 px-3 rounded-lg border border-border bg-card hover:border-primary/50 text-xs font-semibold transition-all data-[active=true]:bg-primary data-[active=true]:text-primary-foreground" data-time="5">Short</button>
                        <button class="timer-preset py-2 px-3 rounded-lg border border-border bg-card hover:border-primary/50 text-xs font-semibold transition-all data-[active=true]:bg-primary data-[active=true]:text-primary-foreground" data-time="15">Long</button>
                    </div>
                </div>

                <!-- Breath Utility -->
                <div id="util-breath" class="hidden flex flex-col items-center justify-center space-y-12 py-10 animate-in fade-in slide-in-from-bottom-4">
                    <div class="relative flex items-center justify-center">
                         <div id="breath-circle-bv" class="absolute inset-0 rounded-full bg-primary/20 blur-xl transition-all duration-[4000ms] ease-in-out"></div>
                         <div id="breath-circle" class="h-48 w-48 rounded-full bg-primary/10 border-4 border-primary flex items-center justify-center transition-all duration-[4000ms] ease-in-out scale-100 z-10 shadow-[0_0_30px_rgba(var(--primary),0.3)]">
                             <span id="breath-text" class="text-xl font-bold tracking-widest uppercase text-primary transition-opacity duration-500">Ready</span>
                        </div>
                    </div>
                    <p id="breath-guide" class="text-muted-foreground text-sm font-medium h-4">Take a deep breath...</p>
                    <button id="breath-toggle-btn" class="px-8 py-3 rounded-full bg-primary text-primary-foreground font-bold shadow-lg hover:bg-primary/90 transition-all">Start Breathing</button>
                </div>

                <!-- Water Utility -->
                <div id="util-water" class="hidden flex flex-col items-center space-y-8 animate-in fade-in slide-in-from-bottom-4">
                     <div class="text-center space-y-1">
                        <h3 class="text-lg font-medium text-muted-foreground">Daily Hydration</h3>
                        <div class="text-4xl font-black tracking-tight"><span id="water-count">0</span> <span class="text-muted-foreground text-2xl font-bold">/ <span id="water-goal">8</span> cups</span></div>
                    </div>

                    <!-- Water Visual -->
                    <div class="relative h-64 w-64 rounded-full border-4 border-blue-100 bg-blue-50/20 overflow-hidden flex items-end justify-center shadow-inner">
                        <div id="water-level" class="w-full bg-blue-500 transition-all duration-1000 ease-in-out relative" style="height: 0%">
                             <div class="absolute top-0 left-0 w-full h-4 bg-blue-400/50 animate-pulse"></div>
                        </div>
                        <div class="absolute inset-0 flex items-center justify-center pointer-events-none">
                            <i data-lucide="droplet" class="h-24 w-24 text-blue-200/50 fill-blue-200/20"></i>
                        </div>
                    </div>

                    <div class="flex items-center gap-6">
                        <button id="water-remove-btn" class="h-12 w-12 rounded-full border border-input bg-card hover:bg-accent flex items-center justify-center transition-all active:scale-95">
                            <i data-lucide="minus" class="h-5 w-5"></i>
                        </button>
                        <button id="water-add-btn" class="h-20 w-20 rounded-full bg-blue-500 text-white shadow-xl shadow-blue-500/30 hover:bg-blue-600 flex items-center justify-center transition-all hover:scale-105 active:scale-95">
                            <i data-lucide="plus" class="h-8 w-8"></i>
                        </button>
                    </div>

                    <div class="flex items-center gap-3 p-4 bg-muted/50 rounded-xl w-full max-w-xs">
                         <div class="p-2 bg-background rounded-lg border border-border shadow-sm">
                            <i data-lucide="bell" class="h-4 w-4 text-blue-500"></i>
                        </div>
                        <div class="flex-1">
                            <p class="text-sm font-semibold">Hourly Reminders</p>
                            <p class="text-xs text-muted-foreground">Nudge if inactive</p>
                        </div>
                        <button id="water-notify-toggle" class="relative inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background bg-input">
                            <span class="pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform translate-x-0" id="water-notify-slider"></span>
                        </button>
                    </div>
                </div>
            </section>

            <!-- Settings View -->
            <section id="view-settings" class="tab-content hidden space-y-8">
                <div class="space-y-4">
                    <h2 class="text-xl font-bold tracking-tight">Storage & Sync</h2>
                    <div class="rounded-xl border bg-card p-6 space-y-4 shadow-sm">
                        <p class="text-sm text-muted-foreground leading-relaxed">Your data is stored locally in your browser. Export it to keep a backup or sync to another device.</p>
                        <div class="grid grid-cols-1 gap-3">
                            <button id="export-btn" class="w-full inline-flex items-center justify-center rounded-md text-sm font-medium border border-input bg-background hover:bg-accent hover:text-accent-foreground h-10 px-4 py-2 transition-colors">
                                <i data-lucide="download" class="h-4 w-4 mr-2"></i> Export (JSON)
                            </button>
                            <label class="w-full inline-flex items-center justify-center rounded-md text-sm font-medium border border-input bg-background hover:bg-accent hover:text-accent-foreground h-10 px-4 py-2 transition-colors cursor-pointer">
                                <i data-lucide="upload" class="h-4 w-4 mr-2"></i> Import
                                <input type="file" id="import-file" class="hidden" accept=".json">
                            </label>
                            <button id="clear-data-btn" class="w-full inline-flex items-center justify-center rounded-md text-sm font-medium bg-destructive text-destructive-foreground hover:bg-destructive/90 h-10 px-4 py-2 transition-colors">
                                <i data-lucide="trash-2" class="h-4 w-4 mr-2"></i> Clear All Data
                            </button>
                        </div>
                    </div>
                </div>

                <div class="space-y-4">
                    <h2 class="text-xl font-bold tracking-tight">Routine</h2>
                    <div class="rounded-xl border bg-card p-6 space-y-4 shadow-sm">
                         <div class="grid grid-cols-2 gap-4">
                            <div class="space-y-2">
                                <label class="text-sm font-semibold flex items-center gap-2">
                                    <i data-lucide="sun" class="h-4 w-4 text-orange-500"></i>
                                    Wake Time
                                </label>
                                <input type="time" id="setting-wake-time" class="flex h-10 w-full rounded-md border border-input bg-background/50 px-3 py-2 text-sm ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2">
                            </div>
                            <div class="space-y-2">
                                <label class="text-sm font-semibold flex items-center gap-2">
                                    <i data-lucide="moon" class="h-4 w-4 text-indigo-500"></i>
                                    Sleep Time
                                </label>
                                <input type="time" id="setting-sleep-time" class="flex h-10 w-full rounded-md border border-input bg-background/50 px-3 py-2 text-sm ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2">
                            </div>
                        </div>

                        <!-- Meal Settings -->
                        <div class="space-y-3 pt-2 border-t border-border/50">
                            <h3 class="text-xs font-bold uppercase tracking-wider text-muted-foreground">Meal Times</h3>
                            <div class="grid grid-cols-3 gap-3">
                                <div class="space-y-1">
                                    <label class="text-xs font-semibold">Breakfast</label>
                                    <input type="time" id="setting-meal-breakfast" class="flex h-9 w-full rounded-md border border-input bg-background/50 px-2 py-1 text-xs focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring">
                                </div>
                                <div class="space-y-1">
                                    <label class="text-xs font-semibold">Lunch</label>
                                    <input type="time" id="setting-meal-lunch" class="flex h-9 w-full rounded-md border border-input bg-background/50 px-2 py-1 text-xs focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring">
                                </div>
                                <div class="space-y-1">
                                    <label class="text-xs font-semibold">Dinner</label>
                                    <input type="time" id="setting-meal-dinner" class="flex h-9 w-full rounded-md border border-input bg-background/50 px-2 py-1 text-xs focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring">
                                </div>
                            </div>
                        </div>
                        
                        <div class="pt-2">
                             <button id="add-meal-schedule-btn" class="w-full inline-flex items-center justify-center rounded-md text-sm font-medium border border-input bg-secondary/50 hover:bg-secondary text-secondary-foreground h-10 px-4 py-2 transition-colors">
                                <i data-lucide="utensils" class="h-4 w-4 mr-2"></i> Add Meal Schedule
                            </button>
                             <p class="text-[10px] text-muted-foreground text-center pt-1">Adds Breakfast (8am), Lunch (1pm), Dinner (8pm)</p>
                        </div>
                    </div>
                </div>

                <div class="space-y-4">
                    <h2 class="text-xl font-bold tracking-tight">System</h2>
                    <div class="flex items-center justify-between rounded-xl border bg-card p-6 shadow-sm">
                        <div class="space-y-0.5">
                            <span class="text-sm font-semibold">Notifications</span>
                            <p class="text-xs text-muted-foreground">Alerts for task starts</p>
                        </div>
                        <div class="flex items-center gap-3">
                            <button onclick="testNotification()" class="text-xs font-bold text-primary hover:underline bg-primary/10 px-3 py-1.5 rounded-lg transition-colors">Test</button>
                            <button id="notify-toggle" class="relative inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background bg-input">
                                <span class="pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform translate-x-0" id="notify-toggle-slider"></span>
                            </button>
                        </div>
                    </div>
                </div>
            </section>

        </main>
        
        <!-- Dialog / Modal for adding tasks/notes -->
        <dialog id="editor-modal" class="p-0 bg-transparent backdrop:bg-background/80 backdrop:backdrop-blur-sm animate-in fade-in duration-200">
            <div class="fixed inset-0 z-50 flex items-end sm:items-center justify-center p-4">
                <div class="bg-card text-foreground w-full max-w-lg rounded-2xl border border-border shadow-2xl p-6 overflow-hidden animate-in slide-in-from-bottom-8 duration-300">
                    <form method="dialog" id="editor-form" class="space-y-6">
                        <div class="flex items-center justify-between">
                             <h3 id="modal-title" class="text-xl font-bold tracking-tight text-foreground">Add Item</h3>
                             <button type="button" id="modal-close-x" class="h-8 w-8 flex items-center justify-center rounded-full hover:bg-accent text-muted-foreground transition-colors">
                                <i data-lucide="x" class="h-4 w-4"></i>
                                <span class="sr-only">Close</span>
                            </button>
                        </div>
                
                        <div class="space-y-4" id="task-fields">
                            <div class="space-y-2">
                                <label class="text-sm font-semibold flex items-center gap-2 text-foreground">
                                    <i data-lucide="type" class="h-4 w-4 text-primary"></i>
                                    Title
                                </label>
                                <input type="text" name="title" class="flex h-11 w-full rounded-xl border border-input bg-background/50 px-4 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary/20 focus-visible:border-primary transition-all" placeholder="e.g. Morning Run">
                            </div>
                            
                            <div class="grid grid-cols-2 gap-4">
                                <div class="space-y-2">
                                    <label class="text-sm font-semibold flex items-center gap-2 text-foreground">
                                        <i data-lucide="clock-3" class="h-4 w-4 text-primary"></i>
                                        Start
                                    </label>
                                    <input type="time" name="startTime" class="flex h-11 w-full rounded-xl border border-input bg-background/50 px-4 py-2 text-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary/20 focus-visible:border-primary transition-all">
                                </div>
                                <div class="space-y-2">
                                    <label class="text-sm font-semibold flex items-center gap-2 text-foreground">
                                        <i data-lucide="flag" class="h-4 w-4 text-primary"></i>
                                        End
                                    </label>
                                    <input type="time" name="endTime" class="flex h-11 w-full rounded-xl border border-input bg-background/50 px-4 py-2 text-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary/20 focus-visible:border-primary transition-all">
                                </div>
                            </div>

                            <div class="space-y-3">
                                <label class="text-sm font-semibold flex items-center gap-2 text-foreground">
                                    <i data-lucide="repeat" class="h-4 w-4 text-primary"></i>
                                    Recurrence
                                </label>
                                <select name="recurrence" id="recurrence-select" class="flex h-11 w-full rounded-xl border border-input bg-background/50 px-4 py-2 text-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary/20 focus-visible:border-primary transition-all">
                                    <option value="none">One-off (Selected Day Only)</option>
                                    <option value="daily">Daily</option>
                                    <option value="weekdays">Specific Weekdays</option>
                                </select>
                            </div>

                            <div id="weekday-selector" class="space-y-2" style="display: none;">
                                <label class="text-sm font-semibold text-muted-foreground pl-1">Repeat on</label>
                                <div class="flex justify-between gap-1">
                                    <label class="flex-1">
                                        <input type="checkbox" name="days" value="0" class="peer hidden">
                                        <div class="h-10 flex items-center justify-center rounded-lg border border-input bg-background/50 text-xs font-bold peer-checked:bg-primary peer-checked:text-primary-foreground peer-checked:border-primary transition-all cursor-pointer">S</div>
                                    </label>
                                    <label class="flex-1">
                                        <input type="checkbox" name="days" value="1" class="peer hidden">
                                        <div class="h-10 flex items-center justify-center rounded-lg border border-input bg-background/50 text-xs font-bold peer-checked:bg-primary peer-checked:text-primary-foreground peer-checked:border-primary transition-all cursor-pointer">M</div>
                                    </label>
                                    <label class="flex-1">
                                        <input type="checkbox" name="days" value="2" class="peer hidden">
                                        <div class="h-10 flex items-center justify-center rounded-lg border border-input bg-background/50 text-xs font-bold peer-checked:bg-primary peer-checked:text-primary-foreground peer-checked:border-primary transition-all cursor-pointer">T</div>
                                    </label>
                                    <label class="flex-1">
                                        <input type="checkbox" name="days" value="3" class="peer hidden">
                                        <div class="h-10 flex items-center justify-center rounded-lg border border-input bg-background/50 text-xs font-bold peer-checked:bg-primary peer-checked:text-primary-foreground peer-checked:border-primary transition-all cursor-pointer">W</div>
                                    </label>
                                    <label class="flex-1">
                                        <input type="checkbox" name="days" value="4" class="peer hidden">
                                        <div class="h-10 flex items-center justify-center rounded-lg border border-input bg-background/50 text-xs font-bold peer-checked:bg-primary peer-checked:text-primary-foreground peer-checked:border-primary transition-all cursor-pointer">T</div>
                                    </label>
                                    <label class="flex-1">
                                        <input type="checkbox" name="days" value="5" class="peer hidden">
                                        <div class="h-10 flex items-center justify-center rounded-lg border border-input bg-background/50 text-xs font-bold peer-checked:bg-primary peer-checked:text-primary-foreground peer-checked:border-primary transition-all cursor-pointer">F</div>
                                    </label>
                                    <label class="flex-1">
                                        <input type="checkbox" name="days" value="6" class="peer hidden">
                                        <div class="h-10 flex items-center justify-center rounded-lg border border-input bg-background/50 text-xs font-bold peer-checked:bg-primary peer-checked:text-primary-foreground peer-checked:border-primary transition-all cursor-pointer">S</div>
                                    </label>
                                </div>
                            </div>
                        </div>
                
                        <div class="space-y-2" id="note-fields" style="display: none;">
                            <label class="text-sm font-semibold flex items-center gap-2 text-foreground">
                                <i data-lucide="sticky-note" class="h-4 w-4 text-primary"></i>
                                Content
                            </label>
                            <textarea name="content" rows="4" class="flex w-full rounded-xl border border-input bg-background/50 px-4 py-2 text-sm placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary/20 focus-visible:border-primary transition-all" placeholder="What's on your mind?"></textarea>
                        </div>

                        <div class="flex flex-col sm:flex-row gap-3 pt-2">
                            <button type="submit" class="order-1 sm:order-2 w-full inline-flex items-center justify-center rounded-xl text-md font-bold bg-primary text-primary-foreground hover:bg-primary/90 h-12 px-8 py-2 transition-all shadow-lg shadow-primary/20">Save Entry</button>
                            <button type="button" id="modal-cancel" class="order-2 sm:order-1 w-full inline-flex items-center justify-center rounded-xl text-md font-medium border border-input bg-background hover:bg-accent h-12 px-8 py-2 transition-all">Cancel</button>
                        </div>
                    </form>
                </div>
            </div>
        </dialog>

        <!-- Bulk Action Bar -->
        <div id="bulk-action-bar" class="fixed bottom-6 left-1/2 -translate-x-1/2 z-[60] bg-primary text-primary-foreground px-6 py-3 rounded-2xl shadow-2xl flex items-center gap-6 translate-y-32 transition-transform duration-300">
            <span class="text-sm font-bold"><span id="selected-count">1</span> Selected</span>
            <div class="h-4 w-px bg-primary-foreground/20"></div>
            <div class="flex items-center gap-4">
                <button id="bulk-delete-btn" class="text-sm font-bold flex items-center gap-2 hover:opacity-80 transition-opacity">
                    <i data-lucide="trash-2" class="h-4 w-4"></i>
                    Delete
                </button>
                <button id="bulk-cancel-btn" class="text-sm font-medium opacity-70 hover:opacity-100 transition-opacity">Cancel</button>
            </div>
        </div>

        <!-- Install Prompt -->
        <div id="install-banner" class="fixed bottom-6 left-1/2 -translate-x-1/2 z-[50] bg-card text-card-foreground px-6 py-4 rounded-2xl shadow-2xl flex items-center gap-4 translate-y-32 transition-transform duration-300 border border-border w-[90%] max-w-sm">
            <img src="logo-square.svg" alt="App Icon" class="h-10 w-10 rounded-xl shadow-sm">
            <div class="flex-1">
                <h3 class="font-bold text-sm">Install App</h3>
                <p class="text-xs text-muted-foreground">Add to home screen for the best experience.</p>
            </div>
            <div class="flex items-center gap-2">
                <button id="install-btn" class="px-4 py-2 bg-primary text-primary-foreground text-xs font-bold rounded-lg shadow-sm hover:scale-105 active:scale-95 transition-all">Install</button>
                <button id="install-dismiss-btn" class="p-2 hover:bg-muted rounded-lg text-muted-foreground transition-colors">
                    <i data-lucide="x" class="h-4 w-4"></i>
                </button>
            </div>
        </div>

        <!-- Custom Delete Modal -->
        <dialog id="delete-modal" class="p-0 bg-transparent backdrop:bg-background/80 backdrop:backdrop-blur-sm animate-in fade-in duration-200">
            <div class="fixed inset-0 z-[70] flex items-center justify-center p-4">
                <div class="bg-card text-foreground w-full max-w-sm rounded-2xl border border-border shadow-2xl p-6 overflow-hidden animate-in zoom-in duration-300">
                    <div class="flex flex-col items-center text-center gap-4">
                        <div class="h-14 w-14 rounded-full bg-destructive/10 text-destructive flex items-center justify-center mb-2">
                            <i data-lucide="alert-triangle" class="h-8 w-8"></i>
                        </div>
                        <h3 class="text-xl font-bold tracking-tight">Delete Task?</h3>
                        <p class="text-sm text-muted-foreground leading-relaxed" id="delete-modal-msg">Are you sure you want to delete this task? This action cannot be undone.</p>
                        
                        <div id="recurrence-delete-options" class="w-full space-y-3 mt-2" style="display: none;">
                            <label class="flex items-center gap-3 p-3 rounded-xl border border-border bg-muted/50 cursor-pointer transition-all hover:bg-muted active:scale-[0.98]">
                                <input type="radio" name="delete-scope" value="once" checked class="h-4 w-4 accent-primary">
                                <span class="text-sm font-medium">Only this occurrence</span>
                            </label>
                            <label class="flex items-center gap-3 p-3 rounded-xl border border-border bg-muted/50 cursor-pointer transition-all hover:bg-muted active:scale-[0.98]">
                                <input type="radio" name="delete-scope" value="all" class="h-4 w-4 accent-primary">
                                <span class="text-sm font-medium">All future occurrences</span>
                            </label>
                        </div>

                        <div class="flex flex-col w-full gap-2 pt-4">
                            <button id="delete-confirm-btn" class="w-full inline-flex items-center justify-center rounded-xl text-md font-bold bg-destructive text-destructive-foreground hover:bg-destructive/90 h-12 px-8 py-2 transition-all">Delete</button>
                            <button id="delete-cancel-btn" class="w-full inline-flex items-center justify-center rounded-xl text-md font-medium border border-input bg-background hover:bg-accent h-12 px-8 py-2 transition-all">Cancel</button>
                        </div>
                    </div>
                </div>
            </div>
        </dialog>

        <!-- Rewards Modal -->
        <dialog id="rewards-modal" class="p-0 bg-transparent backdrop:bg-background/80 backdrop:backdrop-blur-sm animate-in fade-in duration-200">
             <div class="fixed inset-0 z-[80] flex items-center justify-center p-4">
                <div class="bg-card text-foreground w-full max-w-sm rounded-[2rem] border border-border shadow-2xl p-0 overflow-hidden animate-in zoom-in duration-300 relative flex flex-col max-h-[85vh]">
                    
                    <!-- Header -->
                    <div class="relative bg-gradient-to-br from-green-50 to-green-100/50 dark:from-green-950/30 dark:to-background p-6 text-center border-b border-border/50">
                        <button onclick="document.getElementById('rewards-modal').close()" class="absolute top-4 right-4 text-muted-foreground/50 hover:text-foreground transition-colors p-2 rounded-full hover:bg-background/50">
                            <i data-lucide="x" class="h-5 w-5"></i>
                        </button>
                        
                        <div class="inline-flex items-center justify-center h-20 w-20 rounded-full bg-background shadow-lg mb-4 ring-4 ring-background/50 relative">
                             <div class="absolute inset-0 rounded-full bg-gradient-to-tr from-green-500/20 to-transparent"></div>
                            <i data-lucide="tree-deciduous" class="h-10 w-10 text-primary relative z-10"></i>
                        </div>
                        <h2 class="text-2xl font-black tracking-tight mb-1">Your Forest</h2>
                        <p class="text-sm text-muted-foreground font-medium flex items-center justify-center gap-1.5">
                            <i data-lucide="sprout" class="h-3.5 w-3.5"></i>
                            <span id="sapling-count-display">0 Saplings</span>
                        </p>
                    </div>

                    <!-- Content -->
                    <div class="p-6 space-y-6 overflow-y-auto flex-1 custom-scrollbar">
                        <!-- Progress -->
                        <div class="space-y-2">
                             <div class="flex justify-between text-xs font-bold uppercase tracking-wider text-muted-foreground">
                                <span>Next Milestone</span>
                                <span id="sapling-next-text">...</span>
                            </div>
                            <div class="h-4 w-full bg-secondary rounded-full overflow-hidden shadow-inner border border-border/50">
                                <div id="sapling-progress-fill" class="h-full bg-gradient-to-r from-green-400 to-green-600 w-0 transition-all duration-1000 relative">
                                    <div class="absolute inset-0 bg-[url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGRlZnM+PHBhdHRlcm4gaWQ9ImEiIHdpZHRoPSI0MCIgaGVpZ2h0PSI0MCIgcGF0dGVyblVuaXRzPSJ1c2VyU3BhY2VPblVzZSI+PHBhdGggZD0iTTAgNDBMODAgMEg0MEwwIDQweiIgZmlsbD0id2hpdGUiIGZpbGwtb3BhY2l0eT0iMC4xIi8+PC9wYXR0ZXJuPjwvZGVmcz48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJ1cmwoI2EpIi8+PC9zdmc+')] opacity-30"></div>
                                </div>
                            </div>
                        </div>

                        <!-- Grid -->
                        <div id="forest-grid" class="grid grid-cols-5 gap-2 min-h-[100px] p-4 bg-muted/30 rounded-2xl border border-dashed border-border/60 justify-items-center">
                            <!-- Sapling Icons Injected Here -->
                            <div class="h-10 w-10 rounded-full bg-muted flex items-center justify-center text-muted-foreground/30 animate-pulse">
                                <i data-lucide="sprout" class="h-5 w-5"></i>
                            </div>
                        </div>
                        
                        <!-- Actions -->
                        <div class="grid grid-cols-2 gap-3">
                             <button onclick="toggleRewardInfo()" class="flex flex-col items-center justify-center gap-2 p-3 rounded-xl border border-border bg-card hover:bg-accent transition-all group">
                                <div class="h-8 w-8 rounded-full bg-blue-50 text-blue-500 flex items-center justify-center group-hover:scale-110 transition-transform">
                                    <i data-lucide="info" class="h-5 w-5"></i>
                                </div>
                                <span class="text-xs font-bold text-muted-foreground">How it Works</span>
                            </button>
                             <button onclick="viewSaplingHistory()" class="flex flex-col items-center justify-center gap-2 p-3 rounded-xl border border-border bg-card hover:bg-accent transition-all group">
                                <div class="h-8 w-8 rounded-full bg-green-50 text-green-500 flex items-center justify-center group-hover:scale-110 transition-transform">
                                    <i data-lucide="history" class="h-5 w-5"></i>
                                </div>
                                <span class="text-xs font-bold text-muted-foreground">History</span>
                            </button>
                        </div>

                        <!-- Info Reveal (Hidden by default) -->
                         <div id="reward-info-card" class="hidden animate-in fade-in slide-in-from-top-4">
                            <div class="bg-blue-50/50 dark:bg-blue-900/20 p-4 rounded-xl border border-blue-100 dark:border-blue-900 text-sm space-y-3">
                                <h4 class="font-bold text-blue-700 dark:text-blue-300 flex items-center gap-2">
                                    <i data-lucide="sparkles" class="h-4 w-4"></i> Growth Rules
                                </h4>
                                <ul class="space-y-2 text-muted-foreground text-xs leading-relaxed">
                                    <li class="flex items-start gap-2">
                                        <div class="mt-0.5 h-1.5 w-1.5 rounded-full bg-blue-400 shrink-0"></div>
                                        <span>Earn <strong class="text-foreground">10 points</strong> for every task completed (min 1 min duration).</span>
                                    </li>
                                    <li class="flex items-start gap-2">
                                        <div class="mt-0.5 h-1.5 w-1.5 rounded-full bg-blue-400 shrink-0"></div>
                                        <span>Reach <strong class="text-foreground">1000 points</strong> to plant a Sapling.</span>
                                    </li>
                                    <li class="flex items-start gap-2">
                                        <div class="mt-0.5 h-1.5 w-1.5 rounded-full bg-blue-400 shrink-0"></div>
                                        <span>Verify your Saplings to support real-world planting initiatives.</span>
                                    </li>
                                </ul>
                            </div>
                        </div>

                    </div>
                </div>
             </div>
        </dialog>

    </div>
    
    <script src="app.js"></script>
    <script>
        lucide.createIcons();
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js')
                    .then(reg => console.log('SW registered'))
                    .catch(err => console.log('SW failed', err));
            });
        }
    </script>
</body>
</html>
