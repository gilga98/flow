<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Daily Flow</title>
    <meta name="description" content="A simple, distraction-free timetable app.">
    <link rel="manifest" href="manifest.json">
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        darkMode: 'class',
        theme: {
          extend: {
            colors: {
              border: "hsl(var(--border))",
              input: "hsl(var(--input))",
              ring: "hsl(var(--ring))",
              background: "hsl(var(--background))",
              foreground: "hsl(var(--foreground))",
              primary: {
                DEFAULT: "hsl(var(--primary))",
                foreground: "hsl(var(--primary-foreground))",
              },
              secondary: {
                DEFAULT: "hsl(var(--secondary))",
                foreground: "hsl(var(--secondary-foreground))",
              },
              destructive: {
                DEFAULT: "hsl(var(--destructive))",
                foreground: "hsl(var(--destructive-foreground))",
              },
              muted: {
                DEFAULT: "hsl(var(--muted))",
                foreground: "hsl(var(--muted-foreground))",
              },
              accent: {
                DEFAULT: "hsl(var(--accent))",
                foreground: "hsl(var(--accent-foreground))",
              },
              popover: {
                DEFAULT: "hsl(var(--popover))",
                foreground: "hsl(var(--popover-foreground))",
              },
              card: {
                DEFAULT: "hsl(var(--card))",
                foreground: "hsl(var(--card-foreground))",
              },
            },
            borderRadius: {
              lg: "var(--radius)",
              md: "calc(var(--radius) - 2px)",
              sm: "calc(var(--radius) - 4px)",
            },
          },
        },
      }
    </script>
    
    <link rel="stylesheet" href="style.css">
    
    <!-- Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <meta name="theme-color" content="#ffffff" media="(prefers-color-scheme: light)">
    <meta name="theme-color" content="#09090b" media="(prefers-color-scheme: dark)">
</head>
<body class="antialiased font-sans transition-colors duration-300">
    <div id="app" class="min-h-[100dvh] bg-background text-foreground flex flex-col">
        <!-- Header -->
        <header class="sticky top-0 z-50 w-full border-b bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60">
            <div class="container flex h-14 max-w-screen-2xl items-center justify-between px-4 mx-auto">
                <div class="flex items-center gap-2 font-bold text-xl tracking-tight">
                    <div class="bg-primary text-primary-foreground p-1 rounded-lg">
                        <i data-lucide="calendar-clock" class="h-5 w-5"></i>
                    </div>
                    <span>Flow</span>
                </div>
                <div class="flex items-center gap-3">
                    <div id="reward-container" class="flex flex-col items-end gap-1">
                        <div class="flex items-center gap-2">
                             <div id="level-badge" class="px-2 py-0.5 bg-primary text-[10px] font-bold text-primary-foreground rounded uppercase tracking-tighter shadow-sm">
                                Lvl <span id="level-value">1</span>
                            </div>
                            <div id="points-display" class="flex items-center gap-1.5 px-3 py-1 bg-secondary rounded-full border border-border shadow-sm transition-all duration-300">
                                <i data-lucide="trophy" class="h-3.5 w-3.5 text-yellow-500 fill-yellow-500"></i>
                                <span id="points-value" class="text-sm font-semibold tabular-nums">0</span>
                            </div>
                        </div>
                        <div class="w-24 h-1.5 bg-secondary rounded-full overflow-hidden border border-border/50">
                            <div id="level-progress" class="h-full bg-primary transition-all duration-500 ease-out" style="width: 0%"></div>
                        </div>
                    </div>
                    <button id="theme-toggle" class="h-9 w-9 inline-flex items-center justify-center rounded-md border border-input bg-background text-sm font-medium ring-offset-background transition-colors hover:bg-accent hover:text-accent-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50">
                        <i data-lucide="sun" class="h-5 w-5 rotate-0 scale-100 transition-all dark:-rotate-90 dark:scale-0"></i>
                        <i data-lucide="moon" class="absolute h-5 w-5 rotate-90 scale-0 transition-all dark:rotate-0 dark:scale-100"></i>
                        <span class="sr-only">Toggle theme</span>
                    </button>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="flex-1 container px-4 py-8 max-w-lg mx-auto w-full pb-32">
            
            <!-- Dashboard / Hero -->
            <section id="dashboard" class="mb-10 group">
                <div class="rounded-xl border bg-card text-card-foreground shadow-sm transition-all duration-300 hover:shadow-md">
                    <div class="p-6 flex flex-col space-y-2">
                        <div class="flex items-center justify-between">
                            <h3 class="text-[10px] font-bold tracking-widest text-muted-foreground uppercase opacity-70">Current Session</h3>
                            <div class="h-2 w-2 rounded-full bg-primary animate-pulse"></div>
                        </div>
                        <div id="current-task-display" class="text-3xl font-extrabold tracking-tight pt-1">
                            Relaxing
                        </div>
                        <div class="flex items-center gap-2 text-sm text-muted-foreground font-medium">
                            <i data-lucide="clock" class="h-3.5 w-3.5"></i>
                            <span id="current-task-time">Now</span>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Tabs -->
            <div class="sticky top-[72px] z-40 bg-background/80 backdrop-blur-sm -mx-4 px-4 py-2 mb-8">
                <div class="flex w-full items-center p-1 bg-muted rounded-lg border border-border/50">
                    <button data-tab="timeline" class="tab-btn active inline-flex items-center justify-center whitespace-nowrap rounded-md px-3 py-1.5 text-sm font-medium transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50">
                        <i data-lucide="list-todo" class="h-4 w-4 mr-2"></i>Timeline
                    </button>
                    <button data-tab="notes" class="tab-btn inline-flex items-center justify-center whitespace-nowrap rounded-md px-3 py-1.5 text-sm font-medium transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50">
                        <i data-lucide="brain" class="h-4 w-4 mr-2"></i>Notes
                    </button>
                    <button data-tab="settings" class="tab-btn inline-flex items-center justify-center whitespace-nowrap rounded-md px-3 py-1.5 text-sm font-medium transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50">
                        <i data-lucide="settings-2" class="h-4 w-4 mr-2"></i>Settings
                    </button>
                </div>
            </div>

            <!-- Timeline View -->
            <section id="view-timeline" class="tab-content block space-y-6">
                <div class="flex justify-between items-end mb-6">
                    <div>
                        <h2 class="text-2xl font-bold tracking-tight">Timeline</h2>
                        <p class="text-xs text-muted-foreground font-medium" id="selected-date-display">Today</p>
                    </div>
                    <div class="flex items-center gap-2">
                        <button id="select-mode-btn" class="inline-flex items-center justify-center rounded-lg text-sm font-medium border border-input bg-background h-10 px-4 py-2 hover:bg-accent transition-colors">
                            Select
                        </button>
                        <button id="add-task-btn" class="inline-flex items-center justify-center rounded-lg text-sm font-medium ring-offset-background transition-all hover:scale-[1.02] active:scale-[0.98] bg-primary text-primary-foreground h-10 px-4 py-2 hover:bg-primary/90 shadow-sm shadow-primary/20">
                            <i data-lucide="plus" class="h-4 w-4 mr-2"></i> Add Task
                        </button>
                    </div>
                </div>

                <!-- Weekly Scroller -->
                <div id="weekly-scroller" class="flex gap-3 overflow-x-auto pb-4 -mx-4 px-4 no-scrollbar">
                    <!-- Days injected here -->
                </div>
                
                <div id="timeline-list" class="space-y-4 relative pl-2">
                    <!-- Tasks injected here -->
                </div>
                
                <div id="empty-state" class="hidden flex flex-col items-center justify-center py-20 text-center animate-in fade-in zoom-in duration-500">
                    <div class="h-20 w-20 rounded-full bg-muted flex items-center justify-center mb-4">
                        <i data-lucide="coffee" class="h-10 w-10 text-muted-foreground/50"></i>
                    </div>
                    <h3 class="font-semibold text-lg">No tasks scheduled</h3>
                    <p class="text-sm text-muted-foreground max-w-[200px] mt-1">Add your daily rituals and tasks to start flowing.</p>
                </div>
            </section>

            <!-- Notes View -->
            <section id="view-notes" class="tab-content hidden space-y-6">
                 <div class="flex justify-between items-center mb-2">
                    <h2 class="text-2xl font-bold tracking-tight">Brain Dump</h2>
                    <button id="add-note-btn" class="inline-flex items-center justify-center rounded-lg text-sm font-medium ring-offset-background transition-all hover:scale-[1.02] active:scale-[0.98] bg-secondary text-secondary-foreground h-10 px-4 py-2 hover:bg-secondary/80 border border-border">
                        <i data-lucide="sticky-note" class="h-4 w-4 mr-2"></i> New Note
                    </button>
                </div>
                <div id="notes-list" class="grid grid-cols-1 gap-4">
                    <!-- Notes injected here -->
                </div>

                <div id="notes-empty-state" class="hidden flex flex-col items-center justify-center py-20 text-center animate-in fade-in zoom-in duration-500">
                    <div class="h-20 w-20 rounded-full bg-muted flex items-center justify-center mb-4 transition-transform hover:scale-110 duration-300">
                        <i data-lucide="sparkles" class="h-10 w-10 text-muted-foreground/40"></i>
                    </div>
                    <h3 class="font-bold text-lg tracking-tight">Your brain, offloaded</h3>
                    <p class="text-sm text-muted-foreground max-w-[240px] mt-2 leading-relaxed">Capture fleeting thoughts, ideas, or to-dos. Let Flow remember for you.</p>
                </div>
            </section>

            <!-- Settings View -->
            <section id="view-settings" class="tab-content hidden space-y-8">
                <div class="space-y-4">
                    <h2 class="text-xl font-bold tracking-tight">Storage & Sync</h2>
                    <div class="rounded-xl border bg-card p-6 space-y-4 shadow-sm">
                        <p class="text-sm text-muted-foreground leading-relaxed">Your data is stored locally in your browser. Export it to keep a backup or sync to another device.</p>
                        <div class="grid grid-cols-1 gap-3">
                            <button id="export-btn" class="w-full inline-flex items-center justify-center rounded-md text-sm font-medium border border-input bg-background hover:bg-accent hover:text-accent-foreground h-10 px-4 py-2 transition-colors">
                                <i data-lucide="download" class="h-4 w-4 mr-2"></i> Export (JSON)
                            </button>
                            <label class="w-full inline-flex items-center justify-center rounded-md text-sm font-medium border border-input bg-background hover:bg-accent hover:text-accent-foreground h-10 px-4 py-2 transition-colors cursor-pointer">
                                <i data-lucide="upload" class="h-4 w-4 mr-2"></i> Import
                                <input type="file" id="import-file" class="hidden" accept=".json">
                            </label>
                            <button id="clear-data-btn" class="w-full inline-flex items-center justify-center rounded-md text-sm font-medium bg-destructive text-destructive-foreground hover:bg-destructive/90 h-10 px-4 py-2 transition-colors">
                                <i data-lucide="trash-2" class="h-4 w-4 mr-2"></i> Clear All Data
                            </button>
                        </div>
                    </div>
                </div>

                <div class="space-y-4">
                    <h2 class="text-xl font-bold tracking-tight">System</h2>
                    <div class="flex items-center justify-between rounded-xl border bg-card p-6 shadow-sm">
                        <div class="space-y-0.5">
                            <span class="text-sm font-semibold">Notifications</span>
                            <p class="text-xs text-muted-foreground">Alerts for task starts</p>
                        </div>
                        <button id="notify-toggle" class="relative inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background bg-input">
                            <span class="pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform translate-x-0" id="notify-toggle-slider"></span>
                        </button>
                    </div>
                </div>
            </section>

        </main>
        
        <!-- Dialog / Modal for adding tasks/notes -->
        <dialog id="editor-modal" class="p-0 bg-transparent backdrop:bg-background/80 backdrop:backdrop-blur-sm animate-in fade-in duration-200">
            <div class="fixed inset-0 z-50 flex items-end sm:items-center justify-center p-4">
                <div class="bg-card text-foreground w-full max-w-lg rounded-2xl border border-border shadow-2xl p-6 overflow-hidden animate-in slide-in-from-bottom-8 duration-300">
                    <form method="dialog" id="editor-form" class="space-y-6">
                        <div class="flex items-center justify-between">
                             <h3 id="modal-title" class="text-xl font-bold tracking-tight text-foreground">Add Item</h3>
                             <button type="button" id="modal-close-x" class="h-8 w-8 flex items-center justify-center rounded-full hover:bg-accent text-muted-foreground transition-colors">
                                <i data-lucide="x" class="h-4 w-4"></i>
                                <span class="sr-only">Close</span>
                            </button>
                        </div>
                
                        <div class="space-y-4" id="task-fields">
                            <div class="space-y-2">
                                <label class="text-sm font-semibold flex items-center gap-2 text-foreground">
                                    <i data-lucide="type" class="h-4 w-4 text-primary"></i>
                                    Title
                                </label>
                                <input type="text" name="title" class="flex h-11 w-full rounded-xl border border-input bg-background/50 px-4 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary/20 focus-visible:border-primary transition-all" placeholder="e.g. Morning Run">
                            </div>
                            
                            <div class="grid grid-cols-2 gap-4">
                                <div class="space-y-2">
                                    <label class="text-sm font-semibold flex items-center gap-2 text-foreground">
                                        <i data-lucide="clock-3" class="h-4 w-4 text-primary"></i>
                                        Start
                                    </label>
                                    <input type="time" name="startTime" class="flex h-11 w-full rounded-xl border border-input bg-background/50 px-4 py-2 text-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary/20 focus-visible:border-primary transition-all">
                                </div>
                                <div class="space-y-2">
                                    <label class="text-sm font-semibold flex items-center gap-2 text-foreground">
                                        <i data-lucide="flag" class="h-4 w-4 text-primary"></i>
                                        End
                                    </label>
                                    <input type="time" name="endTime" class="flex h-11 w-full rounded-xl border border-input bg-background/50 px-4 py-2 text-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary/20 focus-visible:border-primary transition-all">
                                </div>
                            </div>

                            <div class="space-y-3">
                                <label class="text-sm font-semibold flex items-center gap-2 text-foreground">
                                    <i data-lucide="repeat" class="h-4 w-4 text-primary"></i>
                                    Recurrence
                                </label>
                                <select name="recurrence" id="recurrence-select" class="flex h-11 w-full rounded-xl border border-input bg-background/50 px-4 py-2 text-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary/20 focus-visible:border-primary transition-all">
                                    <option value="none">One-off (Selected Day Only)</option>
                                    <option value="daily">Daily</option>
                                    <option value="weekdays">Specific Weekdays</option>
                                </select>
                            </div>

                            <div id="weekday-selector" class="space-y-2" style="display: none;">
                                <label class="text-sm font-semibold text-muted-foreground pl-1">Repeat on</label>
                                <div class="flex justify-between gap-1">
                                    <label class="flex-1">
                                        <input type="checkbox" name="days" value="0" class="peer hidden">
                                        <div class="h-10 flex items-center justify-center rounded-lg border border-input bg-background/50 text-xs font-bold peer-checked:bg-primary peer-checked:text-primary-foreground peer-checked:border-primary transition-all cursor-pointer">S</div>
                                    </label>
                                    <label class="flex-1">
                                        <input type="checkbox" name="days" value="1" class="peer hidden">
                                        <div class="h-10 flex items-center justify-center rounded-lg border border-input bg-background/50 text-xs font-bold peer-checked:bg-primary peer-checked:text-primary-foreground peer-checked:border-primary transition-all cursor-pointer">M</div>
                                    </label>
                                    <label class="flex-1">
                                        <input type="checkbox" name="days" value="2" class="peer hidden">
                                        <div class="h-10 flex items-center justify-center rounded-lg border border-input bg-background/50 text-xs font-bold peer-checked:bg-primary peer-checked:text-primary-foreground peer-checked:border-primary transition-all cursor-pointer">T</div>
                                    </label>
                                    <label class="flex-1">
                                        <input type="checkbox" name="days" value="3" class="peer hidden">
                                        <div class="h-10 flex items-center justify-center rounded-lg border border-input bg-background/50 text-xs font-bold peer-checked:bg-primary peer-checked:text-primary-foreground peer-checked:border-primary transition-all cursor-pointer">W</div>
                                    </label>
                                    <label class="flex-1">
                                        <input type="checkbox" name="days" value="4" class="peer hidden">
                                        <div class="h-10 flex items-center justify-center rounded-lg border border-input bg-background/50 text-xs font-bold peer-checked:bg-primary peer-checked:text-primary-foreground peer-checked:border-primary transition-all cursor-pointer">T</div>
                                    </label>
                                    <label class="flex-1">
                                        <input type="checkbox" name="days" value="5" class="peer hidden">
                                        <div class="h-10 flex items-center justify-center rounded-lg border border-input bg-background/50 text-xs font-bold peer-checked:bg-primary peer-checked:text-primary-foreground peer-checked:border-primary transition-all cursor-pointer">F</div>
                                    </label>
                                    <label class="flex-1">
                                        <input type="checkbox" name="days" value="6" class="peer hidden">
                                        <div class="h-10 flex items-center justify-center rounded-lg border border-input bg-background/50 text-xs font-bold peer-checked:bg-primary peer-checked:text-primary-foreground peer-checked:border-primary transition-all cursor-pointer">S</div>
                                    </label>
                                </div>
                            </div>
                        </div>
                
                        <div class="space-y-2" id="note-fields" style="display: none;">
                            <label class="text-sm font-semibold flex items-center gap-2 text-foreground">
                                <i data-lucide="sticky-note" class="h-4 w-4 text-primary"></i>
                                Content
                            </label>
                            <textarea name="content" rows="4" class="flex w-full rounded-xl border border-input bg-background/50 px-4 py-2 text-sm placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary/20 focus-visible:border-primary transition-all" placeholder="What's on your mind?"></textarea>
                        </div>

                        <div class="flex flex-col sm:flex-row gap-3 pt-2">
                            <button type="submit" class="order-1 sm:order-2 w-full inline-flex items-center justify-center rounded-xl text-md font-bold bg-primary text-primary-foreground hover:bg-primary/90 h-12 px-8 py-2 transition-all shadow-lg shadow-primary/20">Save Entry</button>
                            <button type="button" id="modal-cancel" class="order-2 sm:order-1 w-full inline-flex items-center justify-center rounded-xl text-md font-medium border border-input bg-background hover:bg-accent h-12 px-8 py-2 transition-all">Cancel</button>
                        </div>
                    </form>
                </div>
            </div>
        </dialog>

        <!-- Bulk Action Bar -->
        <div id="bulk-action-bar" class="fixed bottom-6 left-1/2 -translate-x-1/2 z-[60] bg-primary text-primary-foreground px-6 py-3 rounded-2xl shadow-2xl flex items-center gap-6 translate-y-32 transition-transform duration-300">
            <span class="text-sm font-bold"><span id="selected-count">1</span> Selected</span>
            <div class="h-4 w-px bg-primary-foreground/20"></div>
            <div class="flex items-center gap-4">
                <button id="bulk-delete-btn" class="text-sm font-bold flex items-center gap-2 hover:opacity-80 transition-opacity">
                    <i data-lucide="trash-2" class="h-4 w-4"></i>
                    Delete
                </button>
                <button id="bulk-cancel-btn" class="text-sm font-medium opacity-70 hover:opacity-100 transition-opacity">Cancel</button>
            </div>
        </div>

        <!-- Custom Delete Modal -->
        <dialog id="delete-modal" class="p-0 bg-transparent backdrop:bg-background/80 backdrop:backdrop-blur-sm animate-in fade-in duration-200">
            <div class="fixed inset-0 z-[70] flex items-center justify-center p-4">
                <div class="bg-card text-foreground w-full max-w-sm rounded-2xl border border-border shadow-2xl p-6 overflow-hidden animate-in zoom-in duration-300">
                    <div class="flex flex-col items-center text-center gap-4">
                        <div class="h-14 w-14 rounded-full bg-destructive/10 text-destructive flex items-center justify-center mb-2">
                            <i data-lucide="alert-triangle" class="h-8 w-8"></i>
                        </div>
                        <h3 class="text-xl font-bold tracking-tight">Delete Task?</h3>
                        <p class="text-sm text-muted-foreground leading-relaxed" id="delete-modal-msg">Are you sure you want to delete this task? This action cannot be undone.</p>
                        
                        <div id="recurrence-delete-options" class="w-full space-y-3 mt-2" style="display: none;">
                            <label class="flex items-center gap-3 p-3 rounded-xl border border-border bg-muted/50 cursor-pointer transition-all hover:bg-muted active:scale-[0.98]">
                                <input type="radio" name="delete-scope" value="once" checked class="h-4 w-4 accent-primary">
                                <span class="text-sm font-medium">Only this occurrence</span>
                            </label>
                            <label class="flex items-center gap-3 p-3 rounded-xl border border-border bg-muted/50 cursor-pointer transition-all hover:bg-muted active:scale-[0.98]">
                                <input type="radio" name="delete-scope" value="all" class="h-4 w-4 accent-primary">
                                <span class="text-sm font-medium">All future occurrences</span>
                            </label>
                        </div>

                        <div class="flex flex-col w-full gap-2 pt-4">
                            <button id="delete-confirm-btn" class="w-full inline-flex items-center justify-center rounded-xl text-md font-bold bg-destructive text-destructive-foreground hover:bg-destructive/90 h-12 px-8 py-2 transition-all">Delete</button>
                            <button id="delete-cancel-btn" class="w-full inline-flex items-center justify-center rounded-xl text-md font-medium border border-input bg-background hover:bg-accent h-12 px-8 py-2 transition-all">Cancel</button>
                        </div>
                    </div>
                </div>
            </div>
        </dialog>

    </div>
    
    <script src="app.js"></script>
    <script>
        lucide.createIcons();
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js')
                    .then(reg => console.log('SW registered'))
                    .catch(err => console.log('SW failed', err));
            });
        }
    </script>
</body>
</html>
